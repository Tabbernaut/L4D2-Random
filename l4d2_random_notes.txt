
L4D2_Random
===========


    changelog:
    ---------
            - Damage bonus revamped (easier to destroy): solid starting health counts double, reduction of max damage for smaller bonuses.
            - Now handles tank odds itself, circumventing built in tank odds.
            - Fixed a bug that caused only one team to get a tank sometimes.
            - Fixed reversed reading of the vote blocking cvar.
            - Fixed a bug where some finales were not marked as such, allowing incorrect special events.
            - Fixed a bug that disallowed dual pistols for snipers.
            - Fixed a bug where and old tank flow call resulted in problems.
            - Fixed many problems with gnome bonus scoring, including gnomes losing their value and exploits giving players huge bonuses.
            - Added optional argument to !drop / sm_drop: # (1-5) for slot to drop
            - Added command: !damage_explain to show how bonus is calculated.
            - Made some SDKCalls optional (vomit: breaks boomer flu event, team switching: teamshuffle). Random will load, but disable the relevant functions.
            - Update: Changed z_spawn calls to z_spawn_old (cvar controlled, in case it breaks).
            - Update: Updated gamedata.
            - Uncapped pounce damage (50 dmg max, 1729... range max) for Skeet Shoot event.
        -----
            - Added custom map transition's (Stabby's plugin) to Random by default. Type "!mapset random" to play 5 random maps.
            - Removed infected bots in randhard, randbasic, rand2v2 and rand3v3
            - Fixed gifts being openable in unfrozen readyup.
            - Slightly increased ammo counts all around. Way too many people running out of ammo halfway through a map.
            - Made Sudden Death event easier: fewer common around, no tanks (unless forced).
            - Added static survival bonus: 25 points for making saferoom.
            - Fixed problems with damage bonus & gnome bonus, negative bonus results and incorrect reporting.
            - Fixed Lots of Women event (hilariously) giving survivors only gnomes.
            - Fixed teamshuffle (the old SDKCall approach didn't work anymore).
            - Freezes distance points while tank is alive for Minitanks event and double tanks.
            - Made temporary blindness more effective.
            - Fixed Minitanks event (now only spawns new tanks after one has died). [needs testing]
            - Blocked more than 1 smoker in 2v2 & 3v3. [needs testing]
        -----
            - Tweaked event weights: it is less likely that the same events will appear many times.
            - Now displays penalty bonus in !damage/!health reports, so !bonus isn't required to see it.
            - !damage/!health report now also shows special event bonus/penalty.
            - Car alarms can now only be triggered after the survivors leave the saferoom.
            - Slightly reduced the chances of cars being alarmed.
            - Removed (randomized) hittables from Blood Harvest 1.
            - Keymaster event: doors can not be broken by survivors anymore (except with explosives). Infected can still break them at will.
            - L4D1 event: fixed survivors getting adrenaline at start (sometimes).
            - Added Haunted Doors event.
            - Added Directed by Michael Bay event.
            - Added Bunnyhop Professionals event.
            - Fixed a problem with defib penalty not resetting if a match ended with a Sudden Death event.
            - Firepower event: tweaked amount of ammo available.
            - Prevented the same player getting assigned two tanks in a row.
            - Slightly increased odds of getting double tanks.
            - Witch Hunt event: increased witch spawn frequency.
            - Witch Hunt event: increased damage witches do per swing to upright survivors to 75.
            - Witch Hunt event: bonus points for killing witch now only given if witch did no damage to survivors.
            - Skeets are now always reported (but still only worth points in Skeet Shoot event).
            - Booby Traps event: slightly increased odds of things being booby traps.
            - Some cars have gas in their tank and will explode when shot.
            - Added gift effect: all car alarms disabled.
            - Health Penalty event: increased penalty to 25 points per heal.
            - Shove Penalty event: added grace time so deadstops don't get overcounted.
            - Fixed skeet detection (though chipping with non-shotguns still doesn't count); added detection for sniper/magnum headshot skeets.
            - Fixed a bunch of problems in campaign mode. Now makes survivors try 3 times, then rerandomizes the map.
        -----
            ^ all posted (on SPUF only)
        -----
            - Added randomcoop config: Random Coop Mutation gameplay! Much fun for campaign mode added plusplus.
            - Coop: After 3 failures, the round will automatically be re-randomized.
            - Coop: Added !rerandom command to force re-randomization of the round if players fail to make it.
            - Coop: Sets minimum health for survivors in campaign mode, at round start (50 solid).
            - Coop: Added encounters with insane amounts of hunters, jockeys, witches, etc.
            - Coop: Removed common-size related events (they wouldn't work right with the mutation anyway).
        -----
            - Adjusted skeet reports to match l4d2_skill_detect markup more.
            - Shove Penalty event: now uses l4d2_skill_detect for shove detection.
            - Fixed problem with readyup & ledge-hanging with damage bonus scoring.
            - Fixed minor event/shuffle voting problem on roundhalf switch.
            - Fixed some (potential) problems with tank selection.
            - Solved a problem that made Random think every map was a finale map (limiting the available special events).
            - Now prevents events from being voted for if the next map doesn't suit them.
            - Made it 33% likely that ammo piles (in non-finale maps) are left alone.
            
        -----
            - [ readyup attempt: only the survivor leaving the saferoom gets teleported back ]
            - [ added friendly fire stats table printout ]
            
        

    to-do:
    ------  
            - wait:     gamedata: bwdefib (onrevived()) signature doesn't work for windows (can't fix for now :/)
                        but hey, windows sigs are broken anyway
            
            - test:     still jockey in l4d1 mode ... sigh - can't reproduce (happened after pausing!)
            - test:     paused / unpaused => can't open presents (sometimes?)
                            plus unpausing seems to break some other stuff (event hats, spawns)
            - test:     double smokers in 2v2/3v3?
            - test:     boobytraps on cola/gnome? shouldn't happen.
            - test:     hittable damage in minitanks event (looks ok.. why wrong sometimes?)
                            maybe for car alarm props? some props not taken into account by hittablecontrol plugin?
            
            - tweak:    add optional 'show tank percent' (but not whether tank will spawn) (cvar controlled, for randhard?)
            
            - tweak:    if paused during temporary blindness, re-blind on resume (for as much time as should be remaining..)
            - tweak:    make teamshuffle more sensible (force it to be at least X different from before)
            
            - bugfix:   still not the right penalty counts on double round end.. (only display)
            - bugfix:   if you hold nothing, then get picked up, you get to keep the pistol
            - bugfix:   haunted doors: sometimes doors get stuck.. detect / prevent?
            - bugfix:   scout max ammo still broken / wrong (see rjven) [ doesn't seem to be the case for hunting rifle]
            
            - misc:     add bay RC data to actual KV file setup
            
            - coop:     sudden death event: give everyone full (temp?) health
            - coop:     fix adrenaline rush for coop
            - coop:     special role events - mainly medic - still not working right in coop
            - coop:     sac1: tank door should not be affected by door-affecting events (never seems to work in coop?)
            
    side considerations / 3rd party bugs
    ------------------------------------
            - tweak:    show a list of penalty causers / bonus getters -- at round end ( just use the skill report in playstats)
            - tweak:    [consider] give points for surviving longer during DT3 event (and maybe other events in specific maps too?)
                        holdout bonus.. (and deduct the total you're able to get from the total distance points)
            - note:     the netprop m_iVersus(something) for distance seems to actually work pretty well (with minor bug)
                        CRox reports. try it?
            
    minor cleanup / details
    -----------------------
            - tweak:    haunted doors: synchronize double doors... (bit annoying, can't easily use current methods to 'track' these)
            - tweak:    change boomer combo: 2 => riot, 3 => (a few) jimmy gibbs (maybe)?
            - tweak:    tell infected when survivors (first) find a gnome and how many points it's worth
            - tweak:    EVT_WOMEN: give survivors something (magnum)? when incapped, then take it away from them
            - bugfix:   still broken hud thing on solid health healing (cat from 1+22temp => +27 solid breaks) was downed once (3 max incaps) - cannot reproduce?
                        to try:
                            if (healthBuffer == 0.0) {
                                SetEntPropFloat(i, Prop_Send, "m_healthBuffer", EBLOCK_BONUS_HEALTH_BUFFER);
                                DebugPrintToAll("Health buffer for player [%d] set to %f", i, EBLOCK_BONUS_HEALTH_BUFFER);
                            }
            - nitpick:  MORE ammo than max in clip doesn't work for map-spawned weapons (stays at max when picked up)
                        check + overwrite netprop for client picking it up? what goes on here?
            - nitpick:  if penalty values change (if they ever do), the reported !rand/event values don't change with
            - nitpick:  when gifts spawn inside walls etc, fire effects will not spawn
                            and items might disappear
            - remember: forward Action:L4D_OnSpawnSpecial(&zombieClass, const Float:vector[3], const Float:qangle[3]);
                        = when a BOT (only) spawns, you could do some stuff with that?
            - nitpick:  boomer vomit doesn't really appear convincingly from the survivor's mouth
            - nitpick:  if I ever use g_bNoHealthItems beyond EVT_MEDIC, it will cause probs with PickRandomItem() as it is now.
            - nitpick:  can't see the special role's hat when he's ledged (himself)
            - nitpick:  prevent two ammo piles spawning too close to eachother
            - nitpick:  dark carnival 1 gas cans are not randomized.. (they're a point template, I guess)
            - code:     "The SetEntProp functions have a parameter for the array index, use it instead of doing manual lookups and computing offsets."
    
    notes:
    ------
            - Replacing models with SetEntityModel with survivors doesn't work well - animations are too important.
            - I tried the modelscale netprop, which worked sometimes. most of the time it glitched a LOT of things.
              It made some players practically immune to damage and so on. horrid.
    
    video:
    ------
        ...
        
    ideas:
    ------
            - event:    boomer rain
                            hard to pop boomers, do damage on exploding, pukenuke?
            - event:    hiccups? survivor oncontrollably jumps? (maybe just annoying)
            - event:    tank waves: every 30 seconds, all infected players spawn as mini-tanks?
            - event:    commons making survivor sounds - and SI say 'smoker!' etc
                            only the sounds though! this is a just for fun type of thing: name: 'ventriloquism'
            - event:    'colour coded': survivors and infected players each get a color assigned (maybe switching each attack for inf)
                            only equal-color can pin (/damage?) the survivor
            - event:    bonus round: no distance points, only bonus points for things -- making saferoom = multiplied bonus
                        => problem: SI need incentive to do damage!
                            - skeets
                            - crowns
                            - bhop streaks
                            - charger levels
                            - deadstop penalty?
                            - high pounces (penalty)
                            - common hops
            - event:    'firestarter': fire does insane amounts of damage to everything (mostly survivors), and there are fire items everywhere. fire ammo always  
            
            - gift:     temporary deafness
            - gift  - gift idea: blindness for entire team (shorter)
            - gift  - gift idea: X second slowdown (like EVT_ENCUMBERED)
            - gift  - gift idea: ghost-effect for survivors for X seconds (no outlines for SI) (even if running)
            - gift  - gift idea: see outlines on infected for X seconds ('telepathy')
            - gift  - steal weapon / ammo (on condition of not breaking event)
            
            
            - MAYBE - mini-scavenge for specific rounds (decide per map) / do the research (how well possible? how much work? has anyone done it already?)
            - MAYBE - add 'rerandom' function, working on live round [ for testing / bad starts ]

            
            
Some stuff to keep in mind:
===========================

    useful vocalize (scenes)
            WorldC1M2B37    // alarm started ('lets get out of here')   C, E, 
            
            cough
            AskReady
            GoingToDie
            PainRelieftFirstAid
            Incoming
            help
            transitionclose
            
            backup
            lookout
            waithere
            
            specific for starting to open gift
            -----------
            waithere
            AskReady
            
            coach:
                TakeGrenadeLauncher01
            
            

        prop_physics    spawnflags
        --------------------------
            1 :         "Start Asleep" : 0
            2 :         "Don't take physics damage" : 0
            4 :         "Debris - Don't collide with the player or other debris" : 0
            8 :         "Motion Disabled" : 0
            128 :       "Not affected by rotor wash" : 0
            256 :       "Generate output on +USE " : 1
            512 :       "Prevent pickup" : 0
            1024:       "Prevent motion enable on player bump" : 0
            4096:       "Debris with trigger interaction" : 0
            8192:       "Force server-side (Multiplayer only)" : 0
            32768:      "Enable +use glow effect" : 0
            
        cvars to consider:
        ------------------
            sv_bounce
            adrenaline_revive_speedup
            
            z_common_limit
            z_background_limit
            z_cull_near
            
            z_hear_gunfire_range 1000
            z_hear_runner_far_range 900
            z_vision_range 1000
            z_vision_range_alert 2000
            z_vision_range_obscured 750
            z_vision_range_obscured_alert 1250
            z_acquire_near_range 500
            z_close_target_notice_distance 100
            z_notice_near_range 300
            
            
        What's this:
        ------------
            -Member: m_nHitboxSet (offset 1104) (type integer) (bits 2)
            -Member: m_flModelScale (offset 1108) (type float) (bits 0)
            -Member: m_iGlowType (offset 4) (type integer) (bits 32)
            -Member: m_nGlowRange (offset 8) (type integer) (bits 32)
            -Member: m_glowColorOverride (offset 12) (type integer) (bits 32)
            -Member: m_bFlashing (offset 16) (type integer) (bits 1)
            -Member: m_nRenderFX (offset 276) (type integer) (bits 8)
            -Member: m_nRenderMode (offset 277) (type integer) (bits 8)
            -Member: m_fEffects (offset 204) (type integer) (bits 10)
            -Member: m_clrRender (offset 280) (type integer) (bits 32)
            
        wait.. are these start/end saferoom checks? that'd be funny
            -Member: m_isInMissionStartArea (offset 11484) (type integer) (bits 1)
            -Member: m_bInBombZone (offset 10332) (type integer) (bits 1)
            -Member: m_bInBuyZone (offset 10333) (type integer) (bits 1)
            
        infected netprops:
            -Member: m_iGlowType (offset 4) (type integer) (bits 32)
            -Member: m_nGlowRange (offset 8) (type integer) (bits 32)
            -Member: m_glowColorOverride (offset 12) (type integer) (bits 32)
            -Member: m_bFlashing (offset 16) (type integer) (bits 1)
            -Member: m_nRenderFX (offset 276) (type integer) (bits 8)
            -Member: m_nRenderMode (offset 277) (type integer) (bits 8)
            -Member: m_fEffects (offset 204) (type integer) (bits 10)
            -Member: m_clrRender (offset 280) (type integer) (bits 32)
        may be used to change/force outlines...
        
        play with this..
            // experiment - test
            SetEntityGravity(entity, 400.0);
            
            m_bSurvivorGlowEnabled
            
            
Harder  coop:

    sm_cvar z_hear_gunfire_range 400
    sm_cvar z_hear_runner_far_range 1000
    sm_cvar z_hear_runner_near_range 750
    sm_cvar z_force_attack_from_sound_range 850
    sm_cvar z_vision_range 850
    sm_cvar z_alert_range 1400
    sm_cvar z_vision_range_alert 1700
    sm_cvar z_acquire_far_range 5000
    sm_cvar z_acquire_far_time 2
    sm_cvar z_acquire_near_range 500
    sm_cvar z_acquire_near_time 0.1
    sm_cvar z_vision_range_obscured 700
    sm_cvar z_vision_range_obscured_alert 900
    sm_cvar z_close_target_notice_distance 90
    
    
L4D2_DoAnimationEvent() event list
----------------------------------

4   cock shotgun
5   shell in shotgun
6   cock shotgun

8   drop impact

11  tank death 1

21  surv idle?

34  shove
35  shove 2
36  shove high
37  kick downward

38  m16 reload

42  medkit on self
43  medkit on other
44  incap pickup help
45  medkit on other 2

50  upgrade pack deploy
52  upgrade pack deploy 2

53  can pour
55  cola in slot (maybe useful downward shove)

57  shove/hit receive
58  shove/hit receive 2

64  quick button press (shoulder height)
65  weapon switch

70  some kind of quick thing at hip.. hard to tell
73  "

76  getup (charger?), quick
77  getup (charger?), slow
78  charger getup
80  charger getup - against wall
81  surv flying (tank punch? charger hit?)
86  getup (charger against wall like?)
96  "


 